<chapter id="repmgrd-configuration">
 <title>repmgrd configuration</title>
 <para>
  To use <command>repmgrd</command>, its associated function library must be
  included in <filename>postgresql.conf</filename> with:

  <programlisting>
    shared_preload_libraries = 'repmgr'</programlisting>
 </para>
 <para>
  Changing this setting requires a restart of PostgreSQL; for more details see
  the <ulink url="https://www.postgresql.org/docs/current/static/runtime-config-client.html#GUC-SHARED-PRELOAD-LIBRARIES">PostgreSQL documentation</ulink>.
 </para>
 <para>
  Additionally the following <command>repmgrd</command> options *must* be set in
  <filename>repmgr.conf</filename> (adjust configuration file locations as appropriate):
  <programlisting>
    failover=automatic
    promote_command='repmgr standby promote -f /etc/repmgr.conf --log-to-file'
    follow_command='repmgr standby follow -f /etc/repmgr.conf --log-to-file --upstream-node-id=%n'</programlisting>
 </para>
 <para>
  Note that the <literal>--log-to-file</literal> option will cause
  output generated by the &repmgr; command, when executed by <command>repmgrd</command>,
  to be logged to the same destination configured to receive log output for <command>repmgrd</command>.
  See <filename>repmgr.conf.sample</filename> for further <command>repmgrd</command>-specific settings.
 </para>
 <para>
  When <varname>failover</varname> is set to <literal>automatic</literal>, upon detecting failure
  of the current  primary, <command>repmgrd</command> will execute one of
  <varname>promote_command</varname> or <varname>follow_command</varname>,
  depending on whether the current server is to become the new primary, or
  needs to follow another server which has become the new primary. Note that
  these commands can be any valid shell script which results in one of these
  two actions happening, but if &repmgr;'s <command>standby follow</command> or
  <command>standby promote</command>
  commands are not executed (either directly as shown here, or from a script which
  performs other actions), the &repmgr; metadata will not be updated and
  &repmgr; will no longer function reliably.
 </para>
 <para>
  The <varname>follow_command</varname> should provide the <literal>--upstream-node-id=%n</literal>
  option to <command>repmgr standby follow</command>; the <literal>%n</literal> will be replaced by
  <command>repmgrd</command> with the ID of the new primary node. If this is not provided, &repmgr;
  will attempt to determine the new primary by itself, but  if the
  original primary comes back online after the new primary is promoted, there is a risk that
  <command>repmgr standby follow</command> will result in the node continuing to follow
  the original primary.
 </para>

</chapter>
